%% AEAD Sequence Diagram - Encryption and Verification Flow
sequenceDiagram
  autonumber
  participant S as Sender
  participant A as Attacker (optional)
  participant R as Receiver

  Note over S: Choose N unique per key, have K shared beforehand
  
  S->>S: 1. Encrypt: C = Encrypt with K, N, P
  Note over S: 2. Create Tag: T = MAC with K, N, C, AD<br/>Tag binds C + AD + N to secret key K
  
  S-->>R: Send N, AD, C, T
  
  Note over A: Attacker can intercept and modify<br/>Example: Change C to C' or AD to AD'<br/>BUT cannot create valid tag without K
  
  Note over R: 3. Recompute Tag: T' = MAC with K, N, C, AD<br/>Using received C, AD, N
  R->>R: 4. Compare: Is T' equal to T?
  
  alt Tags Match (T' = T)
    Note over R: ✅ No tampering detected<br/>Data is authentic and unchanged
    R->>R: 5. Decrypt: P = Decrypt with K, N, C
    R-->>R: Output plaintext P
  else Tags Do Not Match (T' ≠ T)
    Note over R: ❌ Tampering detected!<br/>• C, AD, or N was modified, OR<br/>• Wrong key K used<br/>• Attacker cannot forge valid tag
    R-->>R: REJECT - no plaintext revealed
  end
