%% Crypto Fundamentals — Rapid Ramp Mindmap
mindmap
  root((Crypto Fundamentals<br/>Rapid Ramp))
    Trust models & JWT
      JWKS
        JSON Web Key Set of issuer public keys with kid, kty, etc
        Rotation: add new key → sign with new kid → keep old until tokens expire → remove
      Claims to verify
        aud: token intended for your API - reject if not
        iss: exact issuer match - your trusted auth server
        Time: exp/nbf/iat → currently valid window
      HS256 vs RS256/EdDSA
        HS256 HMAC shared secret: single trust domain, issuer==verifier
        RS256/EdDSA public/private: many verifiers, issuer keeps private key, verifiers use JWKS
      OAuth/OIDC
        state: protects against CSRF/redirect-hijack on auth redirect
      JWE vs JWS
        Use JWE when confidentiality required in addition to authenticity - e.g. embed PII/claims
    AEAD & TLS basics
      AEAD invariants
        Nonce must never repeat with same key - repetition breaks confidentiality/integrity
        Tag proves ciphertext integrity & authenticity
        Associated Data AD binds headers/context to encryption
      TLS + ECDHE
        Never reuse ECDHE ephemeral keypairs across sessions - enables forward secrecy
      HTTPS stack
        HTTP → TLS → TCP → IP
      Not pure asymmetric for bulk
        Too slow for large data
        Large ciphertext & operational complexity - key distribution
    Key management & ops
      Envelope encryption
        Data key DEK encrypts data, Master key KEK wraps DEK via KMS/HSM
      Crypto version field
        Store one field per record: algo + key_id + mode/params version
      Rotation
        Master-key rotation: rewrap DEKs only, data untouched
        Data-key rotation: re-encrypt data - batch backfill or lazy on-read write-back
      Authorization to unwrap
        Only service identity allowed via KMS key policy - mTLS/JWT to prove identity
      Encryption context
        Bind labels e.g. tenant_id:record_uuid so wrapped keys cannot be unwrapped elsewhere
      Do-not-log plaintext
        Secrets/keys/tokens, PII payloads, wrapped keys/nonces/tags when sensitive
      Key-incident quick steps
        Disable/rotate affected keys, revoke/expire tokens, re-issue creds, start re-encrypt plan
    Mini system design: Encrypted Notes
      Threat model
        Attackers: DB thief, rogue operator - protect confidentiality/integrity
        Out of scope: client device compromise, TLS covers MITM
      Record format
        Fields: nonce, tag, ciphertext, key_id, wrapped_DEK, AD or AD-hash, crypto_version, created_at
      Write path
        Gen DEK → AEAD plaintext, AD → wrap DEK with KEK in KMS → store ciphertext, tag, nonce, wrapped_DEK, key_id, crypto_version
      Read path
        AuthZ → KMS unwrap DEK, context → verify tag with AD → decrypt
      Rotation & rollback
        KEK rotate: rewrap only, DEK rotate: re-encrypt batch/lazy, keep previous versions until migration done
      Ops & guardrails
        Metrics: decrypt failures, unwrap counts, rate limits, paved SDKs, nonce mgmt, no-PII logs, test vectors & fuzzing

