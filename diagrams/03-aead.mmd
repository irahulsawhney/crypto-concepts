%% AEAD (Authenticated Encryption with Associated Data) â€” Mermaid Cheat Sheet
%% Save as .mmd and preview with any Mermaid renderer.

%% ------------ FLOW OVERVIEW ------------
flowchart TB
  Title["ğŸ” AEAD: Authenticated Encryption with Associated Data"]
  
  subgraph Sender["ğŸ“¤ Sender (Encrypt)"]
    direction TB
    P["ğŸ“„ Plaintext P<br/>(secret data)"]
    AD["ğŸ“‹ Associated Data AD<br/>â€¢ NOT encrypted<br/>â€¢ IS authenticated<br/>â€¢ Examples: headers, userID"]
    K[("ğŸ”‘ Secret Key K<br/>(shared with receiver)")]
    N["ğŸ² Nonce N<br/>â€¢ Random/unique<br/>â€¢ Never reuse with same K"]
    
    P --> E
    AD --> E
    K -.->|encrypts & signs| E
    N --> E
    
    E["âš™ï¸ AEAD Encrypt"]
    
    E --> C["ğŸ”’ Ciphertext C<br/>(encrypted P)"]
    E --> T["âœ… Auth Tag T<br/>(proves integrity)"]
    
    SNote["ğŸ’¡ Sender combines:<br/>â€¢ Encrypts plaintext â†’ ciphertext<br/>â€¢ Creates tag to authenticate C + AD + N"]
  end

  C --> Channel
  T --> Channel
  N --> Channel
  AD --> Channel
  
  subgraph Channel["ğŸŒ Network / Untrusted Channel"]
    Bundle["ğŸ“¦ Sent Together:<br/>â€¢ Ciphertext C<br/>â€¢ Auth Tag T<br/>â€¢ Nonce N<br/>â€¢ Associated Data AD<br/><br/>âš ï¸ Attacker can see/modify"]
  end

  Channel --> Receiver
  
  subgraph Receiver["ğŸ“¥ Receiver (Verify & Decrypt)"]
    direction TB
    KR[("ğŸ”‘ Secret Key K<br/>(same as sender)")]
    
    Vr["âš™ï¸ AEAD Decrypt & Verify"]
    
    KR -.->|decrypts & verifies| Vr
    
    Vr -->|âœ… Tag Valid| Valid["ğŸ‰ Success!<br/>â†’ Output Plaintext P<br/><br/>âœ“ Integrity confirmed<br/>âœ“ Authenticity confirmed"]
    Vr -->|âŒ Tag Invalid| Invalid["ğŸš« REJECT<br/>No plaintext revealed<br/><br/>Reasons:<br/>â€¢ Data was tampered<br/>â€¢ Wrong key used<br/>â€¢ AD or N changed"]
    
    RNote["ğŸ’¡ Receiver verifies:<br/>â€¢ Tag T proves C + AD + N authentic<br/>â€¢ Only then decrypts C â†’ P"]
  end

  %% Styling
  style Sender stroke:#1976d2,stroke-width:2px
  style Channel stroke:#f57c00,stroke-width:2px
  style Receiver stroke:#388e3c,stroke-width:2px
  style Title fill:none,stroke:none,font-size:16px
  style Valid stroke:#2e7d32,stroke-width:2px
  style Invalid stroke:#c62828,stroke-width:2px
  style T stroke:#f9a825,stroke-width:2px
  style SNote stroke:#9e9e9e,stroke-width:1px
  style RNote stroke:#9e9e9e,stroke-width:1px

  %% Notes
  %% - Confidentiality: P is hidden inside C.
  %% - Integrity & Authenticity: T binds (C, AD, N) to K; tampering causes verify failure.
  %% - AD is authenticated but not encrypted (visible headers/metadata).
  %% - N must NEVER repeat with the same K. Reuse can break security catastrophically.

  %% AT-A-GLANCE
  %% â€¢ AEAD = Authenticated Encryption with Associated Data
  %% â€¢ Protects two things at once:
  %%     1) Confidentiality (encrypts P into C)
  %%     2) Integrity/Authenticity (T proves C+AD+N come from someone with K)
  %% â€¢ Associated Data (AD):
  %%     - Not encrypted (visible), but authenticated (tamper-evident)
  %%     - Examples: headers, user/account IDs, API version, timestamps
  %% â€¢ Nonce/IV (N):
  %%     - Unique per (K) to prevent reuse attacks
  %% â€¢ Typical algorithms:
  %%     - AES-GCM, ChaCha20-Poly1305